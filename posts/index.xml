<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Posts on Artenes&#39; BOK</title>
		<link>http://artenes.github.io/posts/</link>
		<description>Recent content in Posts on Artenes&#39; BOK</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>en-Us</language>
		<copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright>
		<lastBuildDate>Tue, 25 Jun 2019 19:12:55 -0400</lastBuildDate>
		<atom:link href="http://artenes.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>Configuring Amazon Aws S3 to Store Images for Your Website</title>
			<link>http://artenes.github.io/posts/configuring-amazon-aws-s3-to-store-images-for-your-website/</link>
			<pubDate>Tue, 25 Jun 2019 19:12:55 -0400</pubDate>
			
			<guid>http://artenes.github.io/posts/configuring-amazon-aws-s3-to-store-images-for-your-website/</guid>
			<description>Before starting  Have an AWS (Amazon Web Services) account (create one here).  Things to note  S3 (Simple Storage Service) is a paid service offered by Amazon. S3 is used to store any kind of data (images, videos, music and such). S3 has a free tier where you can store up to 5GB of data for one year, after this you have to pay to keep access. There is not forver free plan for S3.</description>
			<content type="html"><![CDATA[

<h2 id="before-starting">Before starting</h2>

<ul>
<li>Have an AWS (Amazon Web Services) account (<a href="https://portal.aws.amazon.com/billing/signup#/start">create one here</a>).</li>
</ul>

<h2 id="things-to-note">Things to note</h2>

<ul>
<li>S3 (Simple Storage Service) is a paid service offered by Amazon.</li>
<li>S3 is used to store any kind of data (images, videos, music and such).</li>
<li>S3 has a free tier where you can store up to 5GB of data for one year, after this you have to pay to keep access. <strong>There is not forver free plan for S3</strong>.</li>
<li>You can use an API to store the files or you can mannually do it by the S3 console in AWS&rsquo; website.</li>
</ul>

<h2 id="creating-an-aws-user-for-your-website">Creating an AWS user for your website</h2>

<p>I am assuming that you will use some kind of CMS or website that already knows how to save and get images from S3. If that&rsquo;s the case, then you need to create an user in your AWS account for this website to be able to do this. <strong>If you plan to just upload the images mannualy to S3 then you do not need any more users, so you can skip this step</strong>.</p>

<ul>
<li><a href="https://console.aws.amazon.com/iam/home">Access the IAM (Identity and Access Management) console</a>.</li>
<li>Click in the &ldquo;Add user&rdquo; blue button.</li>
<li>In the &ldquo;User name&rdquo; field give a name for the user of your website (e.g. MyWebsite).</li>
<li>In the &ldquo;Access Type&rdquo; field, mark the &ldquo;Programmatic access&rdquo; checkbox.</li>
<li>Click in the &ldquo;Next: Permissions&rdquo; blue button.</li>
<li>Click in &ldquo;Attach existing policies directly&rdquo; option.</li>
<li>In the search field search for &ldquo;S3&rdquo; (without the quotation marks).</li>
<li>In the list of results click in the checkbox right before the &ldquo;AmazonS3FullAccess&rdquo; result.</li>
<li>Click in the &ldquo;Next: Tags&rdquo; blue button.</li>
<li>Click in the &ldquo;Next: Review&rdquo; blue button.</li>
<li>Click in the &ldquo;Create user&rdquo; blue button.</li>
<li>Click in the &ldquo;Dowload .csv&rdquo; button to dowload the data for your website user. &ldquo;Access key ID&rdquo; and &ldquo;Secret access key&rdquo; will be useful for your website to access your bucket programmatically.</li>
<li>Click the &ldquo;Close&rdquo; button at the bottom right.</li>
<li>Click in the name of the user you created in the list of users.</li>
<li>Copy and paste the &ldquo;User ARN&rdquo; field&rsquo;s value to a text file. We will use this later.</li>
</ul>

<h2 id="creating-a-bucket">Creating a bucket</h2>

<p>A bucket is just like a folder in your machine, a place to put files and more folders.</p>

<ul>
<li><a href="https://s3.console.aws.amazon.com/s3/home">Access your S3 console</a>.</li>
<li>Click in the blue button &ldquo;Create bucket&rdquo;.</li>
<li>Fill the field &ldquo;Bucket name&rdquo; with a name that makes sense for your bucket (e.g. myveryuniquewebsite).</li>
<li>In the &ldquo;Region&rdquo; field, select a region that is closest to your region (e.g. US East (Ohio)).</li>
<li>Click Create at the bottom left.</li>
</ul>

<h2 id="disabling-blocking-of-public-bucket-policies">Disabling blocking of public bucket policies</h2>

<p>By default, S3 blocks any access to any of the files you upload to your buckets. We have to mannualy tell it to not block everything since our contents will be accessible by anyone in the web.</p>

<ul>
<li>Click in your bucket&rsquo;s name in the list of buckets.</li>
<li>Click in the &ldquo;Permissions&rdquo; tab.</li>
<li>Click in the &ldquo;Edit&rdquo; button at the right end of the &ldquo;Block all public access&rdquo; rectangle.</li>
<li>Uncheck the first checkbox and check next two checkboxes, leaving the last two unchecked.</li>
<li>Click in the blue &ldquo;Save&rdquo; button at the top right corner of the rectangle.</li>
<li>A pop up will appear. Type the word &ldquo;confirm&rdquo; in the text field and hit the &ldquo;Confirm&rdquo; button.</li>
</ul>

<h2 id="defining-bucket-policies">Defining Bucket Policies</h2>

<p>In the previous step we&rsquo;ve opened the access to our bucket. But now we have to strict it again so not anyone can try to upload files to our bucket. For this we will use Bucket Policies that makes use of its own language to describe for who we want give access to perform a certain operation in our bucket. In this case we want: 1. Let everyone see all the content in our bucket; 2. Only allow me and my website to put content in the bucket.</p>

<ul>
<li>While in the permissions tab of your bucket, click in the &ldquo;Bucket Policy&rdquo; sub-tab.</li>
<li>Paste the following piece of Bucket Policy in the text field.</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Id&#34;</span><span class="p">:</span> <span class="s2">&#34;Policy1561128789667&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&#34;Sid&#34;</span><span class="p">:</span> <span class="s2">&#34;AllowWebsite&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Principal&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;AWS&#34;</span><span class="p">:</span> <span class="s2">&#34;PUT_YOUR_USER_HERE&#34;</span>
            <span class="p">},</span>
            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;s3:ListBucket&#34;</span><span class="p">,</span>
                <span class="s2">&#34;s3:DeleteObject&#34;</span><span class="p">,</span>
                <span class="s2">&#34;s3:GetObject&#34;</span><span class="p">,</span>
                <span class="s2">&#34;s3:PutObject&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;PUT_YOUR_BUCKET_HERE&#34;</span><span class="p">,</span>
                <span class="s2">&#34;PUT_YOUR_BUCKET_HERE/*&#34;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&#34;Sid&#34;</span><span class="p">:</span> <span class="s2">&#34;AllowViewer&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Principal&#34;</span><span class="p">:</span> <span class="s2">&#34;*&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="s2">&#34;s3:GetObject&#34;</span><span class="p">,</span>
            <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="s2">&#34;PUT_YOUR_BUCKET_HERE/*&#34;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></div>
<ul>
<li>Replace <code>PUT_YOUR_BUCKET_HERE</code> with the ARN (Amazon Resource Name) for your bucket. Just look for the value at the right of the title &ldquo;Bucket policy editor&rdquo; (e.g. arn:aws:s3:::myspecialuniquebucket). Pay attention to not delete the <code>/*</code> at the end of some of these.</li>
<li>Replace <code>PUT_YOUR_USER_HERE</code> with the ARN of the user of your website. We already got this value in the first step, if you didn&rsquo;t, go back to the <a href="https://console.aws.amazon.com/iam/home">IAM console</a> and get it (e.g. arn:aws:iam::388742887624:user/MyWebsite).</li>
<li>Click in the blue &ldquo;Save&rdquo; button at the right top corner of where you pasted the code above.</li>
<li>You will see a warning that &ldquo;This bucket has public access&rdquo;. This is not a problem because that&rsquo;s out intention. The content here needs to be accessible to anyone. Just the upload needs to be restricted.</li>
</ul>

<p>An explanation about the policy file above if you are interested. This file is telling S3 that we have two <code>Statement</code>. One called <code>AllowWebSite</code> and other <code>AllowViewer</code>.</p>

<p>The <code>AllowWebiste</code> has an <code>Effect</code> to <code>Allow</code> our user (<code>Principal</code>) to perform a set of <code>Action</code> in the buckets with the names under <code>Resource</code>. We have two here because for some actions we need to define that it needs to happen either on the whole bucket or just in the items inside the bucket (not the bucket itself).</p>

<p>The <code>AllowViewer</code> has an <code>Effect</code> to <code>Allow</code> any user (<code>*</code>) to perform the <code>Action</code> to view any file stored in our bucket with the name under <code>Resource</code>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Now you can upload files directly in the S3 panel or give the &ldquo;Access key ID&rdquo; and &ldquo;Secret access key&rdquo; to your website so you can upload images through it (supposing your website already knows how to do this and you do not need to implement it yourself).</p>

<h2 id="context">Context</h2>

<p>I was trying to put a <a href="https://ghost.org/">Ghost</a> blog in <a href="https://heroku.com/">Heroku</a>. Since it does not support file storage I&rsquo;ve decided to use S3. I found that it is very complicated to get the idea of the policies. But once done, you do not have to worry about it.</p>
]]></content>
		</item>
		
		<item>
			<title>Using Robolectric for Unit Tests in Android</title>
			<link>http://artenes.github.io/posts/using-robolectric-for-unit-tests-in-android/</link>
			<pubDate>Mon, 24 Jun 2019 21:01:34 -0400</pubDate>
			
			<guid>http://artenes.github.io/posts/using-robolectric-for-unit-tests-in-android/</guid>
			<description>To start, add the following to your build.gradle file:
android { testOptions { unitTests { includeAndroidResources = true } } } dependencies { testImplementation &amp;#39;org.robolectric:robolectric:4.3&amp;#39; } And annotate your test with the Robolectric test runner:
import org.robolectric.RobolectricTestRunner @RunWith(RobolectricTestRunner::class) public class SandwichTest { } We want to test the following class. It represents the device and exposes two methods: ìsInAirplaneMode and ìsWithLowBattery. Both of them make use of the Android framework to check if the device is with Airplane mode enabled or if it has enough battery.</description>
			<content type="html"><![CDATA[

<p>To start, add the following to your <code>build.gradle</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">android</span>  <span class="o">{</span>  
  <span class="n">testOptions</span>  <span class="o">{</span>  
    <span class="n">unitTests</span>  <span class="o">{</span>  
      <span class="n">includeAndroidResources</span>  <span class="o">=</span>  <span class="kc">true</span>  
    <span class="o">}</span>  
  <span class="o">}</span>  
<span class="o">}</span>  

<span class="n">dependencies</span>  <span class="o">{</span>
  <span class="n">testImplementation</span> <span class="s1">&#39;org.robolectric:robolectric:4.3&#39;</span>
<span class="o">}</span></code></pre></div>
<p>And annotate your test with the Robolectric test runner:</p>
<div class="highlight"><pre class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">import</span> <span class="nn">org.robolectric.RobolectricTestRunner</span>

<span class="n">@RunWith</span><span class="p">(</span><span class="n">RobolectricTestRunner</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>  
<span class="k">public</span> <span class="k">class</span> <span class="nc">SandwichTest</span> <span class="p">{</span>
<span class="p">}</span></code></pre></div>
<p>We want to test the following class. It represents the device and exposes two methods: <code>ìsInAirplaneMode</code> and <code>ìsWithLowBattery</code>. Both of them make use of the Android framework to check if the device is with Airplane mode enabled or if it has enough battery.</p>
<div class="highlight"><pre class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">import</span> <span class="nn">android.content.Context</span>
<span class="k">import</span> <span class="nn">android.provider.Settings</span>
<span class="k">import</span> <span class="nn">android.provider.Settings.Global.AIRPLANE_MODE_ON</span>
<span class="k">import</span> <span class="nn">android.os.BatteryManager</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Device</span><span class="p">(</span><span class="k">private</span> <span class="k">val</span> <span class="py">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="p">{</span>  
      
  <span class="k">fun</span> <span class="nf">isInAirplaneMode</span><span class="p">():</span> <span class="n">Boolean</span> <span class="p">{</span>  
    <span class="k">return</span> <span class="n">Settings</span><span class="p">.</span><span class="n">System</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">contentResolver</span><span class="p">,</span> <span class="n">Settings</span><span class="p">.</span><span class="n">Global</span><span class="p">.</span><span class="n">AIRPLANE_MODE_ON</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span> <span class="p">!=</span> <span class="m">0</span>
  <span class="p">}</span>  

  <span class="k">fun</span> <span class="nf">isWithLowBattery</span><span class="p">():</span> <span class="n">Boolean</span> <span class="p">{</span>  
    <span class="k">val</span> <span class="py">manager</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">BATTERY_SERVICE</span><span class="p">)</span> <span class="k">as</span> <span class="n">BatteryManager</span>  
    <span class="k">val</span> <span class="py">level</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">getIntProperty</span><span class="p">(</span><span class="n">BatteryManager</span><span class="p">.</span><span class="n">BATTERY_PROPERTY_CAPACITY</span><span class="p">)</span>  
    <span class="k">val</span> <span class="py">isCharging</span> <span class="p">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">isCharging</span>
    <span class="k">return</span> <span class="n">level</span> <span class="p">&lt;=</span> <span class="m">15</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">isCharging</span>  
  <span class="p">}</span>  
    
<span class="p">}</span></code></pre></div>
<h2 id="to-test-isinairplanemode-method">To test <code>isInAirplaneMode</code> method</h2>

<p>We would have two tests to validate the two possible outcomes, both implemented in the code bloack below. Pay attention to the <code>ShadowSettings</code> class. It is a class provided by Robolectric and it belogs to this collection of classes called &ldquo;Sadow&rdquo; classes. Instances of these classes are created along the real Android system classes to allow you to manipulate their behaviour. Such as in this test case where we call <code>ShadowSettings.setAirplaneMode</code> to set if either true or false would be returned from the <code>Settings.System.getInt</code> call in our <code>Device</code> class to check if Airplane is enabled or not.</p>

<p>We can figure it out if an Android class has a Shadow available in Robolectric by prepending &ldquo;Shadow&rdquo; to the name of the class. We can use the <a href="http://robolectric.org/javadoc/4.3/">Robolectric API docs</a> to see if such a class exists or not by typing its name in the search box at the top of the page. If it does not exists, we would have to implement it ourselves, which is not complicated.</p>
<div class="highlight"><pre class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">import</span> <span class="nn">org.robolectric.shadows.ShadowSettings</span>
<span class="k">import</span> <span class="nn">org.junit.Before</span>  
<span class="k">import</span> <span class="nn">org.junit.Test</span>
<span class="k">import</span> <span class="nn">org.robolectric.RuntimeEnvironment</span>

<span class="n">@Before</span>  
<span class="k">fun</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>  
  <span class="k">val</span> <span class="py">context</span> <span class="p">=</span> <span class="n">RuntimeEnvironment</span><span class="p">.</span><span class="n">application</span>  
  <span class="n">device</span> <span class="p">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>  
<span class="p">}</span>  
  
<span class="n">@Test</span>  
<span class="k">fun</span> <span class="nf">isInAirplaneMode_returnsTrueIfAirplaneIsEnabled</span><span class="p">()</span> <span class="p">{</span>  
  <span class="c1">//given the device is with airplane on  
</span><span class="c1"></span>  <span class="n">ShadowSettings</span><span class="p">.</span><span class="n">setAirplaneMode</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>  

  <span class="c1">//when I check it  
</span><span class="c1"></span>  <span class="k">val</span> <span class="py">isAirplaneOn</span> <span class="p">=</span> <span class="n">device</span><span class="p">.</span><span class="n">isInAirplaneMode</span><span class="p">()</span>  

  <span class="c1">//then it should be true  
</span><span class="c1"></span>  <span class="n">assertTrue</span><span class="p">(</span><span class="n">isAirplaneOn</span><span class="p">)</span>  
<span class="p">}</span>  
  
<span class="n">@Test</span>  
<span class="k">fun</span> <span class="nf">isInAirplaneMode_returnsFalseIfAirplaneIsDisabled</span><span class="p">()</span> <span class="p">{</span>  
  <span class="c1">//given the device is with airplane off  
</span><span class="c1"></span>  <span class="n">ShadowSettings</span><span class="p">.</span><span class="n">setAirplaneMode</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>  

  <span class="c1">//when I check it  
</span><span class="c1"></span>  <span class="k">val</span> <span class="py">isAirplaneOn</span> <span class="p">=</span> <span class="n">device</span><span class="p">.</span><span class="n">isInAirplaneMode</span><span class="p">()</span>  

  <span class="c1">//then it should be false  
</span><span class="c1"></span>  <span class="n">assertFalse</span><span class="p">(</span><span class="n">isAirplaneOn</span><span class="p">)</span>  
<span class="p">}</span></code></pre></div>
<h2 id="to-test-iswithlowbattery-method">To test <code>isWithLowBattery</code> method</h2>

<p>Same thing here, two tests will be necessary. The difference is in the <code>setUp</code> method. Since we we are dealing with a non-static method, we have to get the reference to the shadow object that we need to manipulate. Inside of <code>Device</code> class we get the instance of <code>BatteryManager</code> by calling <code>context.getSystemService(Context.BATTERY_SERVICE) as BatteryManager</code>. We will do the same, but we will pass the reference to the Robolectric method called <code>Shadows.shadowOf</code>. As said before, each object has a corresponding shadow, so to get it we need the object reference and a call to <code>Shadows.shadowOf</code>. It works like a key-value map, where the reference is the key.</p>

<p>After getting the reference, we can manipulate it by calling the methods that it provided. In this case I need to control the level of the battery and if either the device is charging or not.</p>
<div class="highlight"><pre class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">import</span> <span class="nn">org.junit.Before</span>  
<span class="k">import</span> <span class="nn">org.junit.Test</span>
<span class="k">import</span> <span class="nn">org.robolectric.RuntimeEnvironment</span>
<span class="k">import</span> <span class="nn">org.robolectric.shadows.ShadowBatteryManager</span>
<span class="k">import</span> <span class="nn">android.os.BatteryManager</span>

<span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">device</span><span class="p">:</span> <span class="n">Device</span>  
<span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">batteryManager</span><span class="p">:</span> <span class="n">ShadowBatteryManager</span>  
  
<span class="n">@Before</span>  
<span class="k">fun</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>  
  <span class="k">val</span> <span class="py">context</span> <span class="p">=</span> <span class="n">RuntimeEnvironment</span><span class="p">.</span><span class="n">application</span>  
  <span class="n">device</span> <span class="p">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>  
  <span class="n">batteryManager</span> <span class="p">=</span> <span class="n">Shadows</span><span class="p">.</span><span class="n">shadowOf</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">BATTERY_SERVICE</span><span class="p">)</span> <span class="k">as</span> <span class="n">BatteryManager</span><span class="p">)</span>  
<span class="p">}</span>
  
<span class="n">@Test</span>  
<span class="k">fun</span> <span class="nf">isWithLowBattery_returnsTrueIfDeviceIsWithLowBatteryAndNotCharging</span><span class="p">()</span> <span class="p">{</span>  
  <span class="c1">//given the device has 10% of battery and it is not charging  
</span><span class="c1"></span>  <span class="n">batteryManager</span><span class="p">.</span><span class="n">setIntProperty</span><span class="p">(</span><span class="n">BatteryManager</span><span class="p">.</span><span class="n">BATTERY_PROPERTY_CAPACITY</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>  
  <span class="n">batteryManager</span><span class="p">.</span><span class="n">setIsCharging</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>  

  <span class="c1">//when I check it  
</span><span class="c1"></span>  <span class="k">val</span> <span class="py">isLowBattery</span> <span class="p">=</span> <span class="n">device</span><span class="p">.</span><span class="n">isWithLowBattery</span><span class="p">()</span>  

  <span class="c1">//then it should be true  
</span><span class="c1"></span>  <span class="n">assertTrue</span><span class="p">(</span><span class="n">isLowBattery</span><span class="p">)</span>  
<span class="p">}</span>  
  
<span class="n">@Test</span>  
<span class="k">fun</span> <span class="nf">isWithLowBattery_returnsFalseIfDeviceIsWithBatteryAndIsCharging</span><span class="p">()</span> <span class="p">{</span>  
  <span class="c1">//given the device has 90% of battery and it is charging  
</span><span class="c1"></span>  <span class="n">batteryManager</span><span class="p">.</span><span class="n">setIntProperty</span><span class="p">(</span><span class="n">BatteryManager</span><span class="p">.</span><span class="n">BATTERY_PROPERTY_CAPACITY</span><span class="p">,</span> <span class="m">90</span><span class="p">)</span>  
  <span class="n">batteryManager</span><span class="p">.</span><span class="n">setIsCharging</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>  

  <span class="c1">//when I check it  
</span><span class="c1"></span>  <span class="k">val</span> <span class="py">isLowBattery</span> <span class="p">=</span> <span class="n">device</span><span class="p">.</span><span class="n">isWithLowBattery</span><span class="p">()</span>  

  <span class="c1">//then it should be false  
</span><span class="c1"></span>  <span class="n">assertFalse</span><span class="p">(</span><span class="n">isLowBattery</span><span class="p">)</span>  
<span class="p">}</span></code></pre></div>
<h2 id="conclusion">Conclusion</h2>

<p>This is the basic gist of Robolectric. Instead of using <code>mocks</code>, we use <code>fakes</code> to test out code that depends on Android. Robolectric provides a ton of shadows for various Android classes. But if there is a class that do not has a shadow, <a href="https://himbeer.farm/2018/11/custom-shadows/">you can easily implement a shadow for it</a>.</p>
]]></content>
		</item>
		
	</channel>
</rss>
